<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Odyssey: Rise of the Collectors</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-gold: #FFD700;
            --secondary-orange: #FF6B35;
            --accent-purple: #7209B7;
            --neon-blue: #00F5FF;
            --deep-space: #0A0A0A;
            --space-blue: #1A1A2E;
            --cosmic-purple: #16213E;
            --success-green: #00FF88;
            --danger-red: #FF073A;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: radial-gradient(ellipse at center, var(--space-blue) 0%, var(--deep-space) 50%, #000 100%);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.05'%3E%3Cpolygon fill='%23fff' points='50 0 60 40 100 50 60 60 50 100 40 60 0 50 40 40'/%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.1;
            animation: bgFloat 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Enhanced Starfield */
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 1;
        }

        .star {
            position: absolute;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }

        .star-small {
            width: 1px;
            height: 1px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 2px rgba(255, 255, 255, 0.5);
        }

        .star-medium {
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            box-shadow: 0 0 4px var(--neon-blue);
        }

        .star-large {
            width: 3px;
            height: 3px;
            background: var(--primary-gold);
            box-shadow: 0 0 6px var(--primary-gold);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Floating particles */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange));
            border-radius: 50%;
            animation: float 8s infinite linear;
            opacity: 0.7;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: none;
            padding: 20px;
            overflow-y: auto;
            padding-bottom: 80px;
            backdrop-filter: blur(20px);
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            animation: screenSlide 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes screenSlide {
            0% {
                opacity: 0;
                transform: translateX(50px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Premium Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            border-radius: 25px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple), var(--neon-blue));
            border-radius: 25px;
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite alternate;
        }

        @keyframes borderGlow {
            0% { filter: blur(2px) brightness(1); }
            100% { filter: blur(4px) brightness(1.5); }
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .resources {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 53, 0.1));
            padding: 10px 15px;
            border-radius: 30px;
            border: 1px solid rgba(255, 215, 0, 0.5);
            font-size: 14px;
            font-weight: 600;
            box-shadow: 
                0 4px 15px rgba(255, 215, 0, 0.2),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .resource::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: resourceShimmer 3s infinite;
        }

        @keyframes resourceShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .resource:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        /* Enhanced Navigation */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(20px);
            border-top: 2px solid transparent;
            background-clip: padding-box;
            z-index: 50;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
        }

        .nav-bar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple), var(--neon-blue));
        }

        .nav-btn {
            flex: 1;
            padding: 15px 8px;
            text-align: center;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 215, 0, 0.1), transparent);
            opacity: 0;
            transition: all 0.4s ease;
        }

        .nav-btn.active {
            color: var(--primary-gold);
            transform: scale(1.1);
        }

        .nav-btn.active::before {
            opacity: 1;
        }

        .nav-btn:hover {
            color: var(--primary-gold);
            transform: translateY(-3px);
        }

        .nav-btn div:first-child {
            font-size: 20px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover div:first-child {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px var(--primary-gold));
        }

        /* Premium Galaxy Map */
        .galaxy-map {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            flex: 1;
            padding: 20px 0;
        }

        .planet {
            position: relative;
            aspect-ratio: 1;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .planet::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary-gold),
                var(--secondary-orange),
                var(--accent-purple),
                var(--neon-blue),
                var(--primary-gold)
            );
            animation: planetOrbit 6s linear infinite;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .planet:hover::before {
            opacity: 0.8;
        }

        @keyframes planetOrbit {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .planet-1 {
            background: radial-gradient(circle at 30% 30%, #FF6B35, #D84315, #8B2500);
            box-shadow: 
                0 0 40px rgba(255, 107, 53, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet-2 {
            background: radial-gradient(circle at 30% 30%, #2196F3, #1565C0, #0D47A1);
            box-shadow: 
                0 0 40px rgba(33, 150, 243, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet-3 {
            background: radial-gradient(circle at 30% 30%, #9C27B0, #6A1B9A, #4A148C);
            box-shadow: 
                0 0 40px rgba(156, 39, 176, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet-4 {
            background: radial-gradient(circle at 30% 30%, #4CAF50, #2E7D32, #1B5E20);
            box-shadow: 
                0 0 40px rgba(76, 175, 80, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet-5 {
            background: radial-gradient(circle at 30% 30%, #FFC107, #F57F17, #E65100);
            box-shadow: 
                0 0 40px rgba(255, 193, 7, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet-6 {
            background: radial-gradient(circle at 30% 30%, #E91E63, #AD1457, #880E4F);
            box-shadow: 
                0 0 40px rgba(233, 30, 99, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .planet:hover {
            transform: scale(1.15) translateZ(20px);
            filter: brightness(1.3) saturate(1.2);
        }

        .planet:active {
            transform: scale(0.95);
        }

        .planet-info {
            position: relative;
            z-index: 2;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        .planet-info div:first-child {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .planet-info div:last-child {
            font-size: 11px;
            opacity: 0.9;
        }

        /* Premium Mining Interface */
        .mining-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            padding: 10px;
        }

        .mining-area {
            width: 280px;
            height: 280px;
            border-radius: 30px;
            background: 
                radial-gradient(circle at center, rgba(255, 215, 0, 0.15), transparent 50%),
                linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
            border: 3px solid transparent;
            background-clip: padding-box;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 40px rgba(255, 215, 0, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .mining-area::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple));
            border-radius: 30px;
            z-index: -1;
            animation: miningGlow 2s ease-in-out infinite alternate;
        }

        @keyframes miningGlow {
            0% { filter: blur(4px) brightness(1); }
            100% { filter: blur(8px) brightness(1.5); }
        }

        .mining-area:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 
                0 20px 60px rgba(255, 215, 0, 0.5),
                inset 0 0 40px rgba(255, 255, 255, 0.2);
        }

        .mining-area:active {
            transform: scale(0.98);
        }

        .mining-beam {
            position: absolute;
            width: 6px;
            height: 80px;
            background: linear-gradient(to bottom, 
                var(--primary-gold), 
                var(--secondary-orange), 
                transparent);
            box-shadow: 
                0 0 20px var(--primary-gold),
                0 0 40px rgba(255, 215, 0, 0.5);
            animation: miningBeam 1.2s ease-in-out;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 3px;
        }

        @keyframes miningBeam {
            0% { 
                opacity: 0; 
                height: 0; 
                transform: translate(-50%, -50%) scale(0.5); 
            }
            30% { 
                opacity: 1; 
                height: 80px; 
                transform: translate(-50%, -50%) scale(1); 
            }
            70% { 
                opacity: 1; 
                height: 80px; 
                transform: translate(-50%, -50%) scale(1.1); 
            }
            100% { 
                opacity: 0; 
                height: 80px; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }

        /* Energy Bar Enhancement */
        .energy-bar {
            width: 100%;
            max-width: 320px;
            height: 25px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(26, 26, 46, 0.6));
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
        }

        .energy-bar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--secondary-orange), var(--primary-gold));
            border-radius: 15px;
            z-index: -1;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--secondary-orange), 
                var(--primary-gold), 
                var(--success-green));
            transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.6),
                inset 0 0 10px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .energy-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: energyPulse 2s infinite;
        }

        @keyframes energyPulse {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 30px;
            color: var(--primary-gold);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: 15px;
            font-weight: 600;
            min-width: 140px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange));
            border-radius: 30px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.6s ease;
        }

        .action-btn:hover {
            color: #000;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 35px rgba(255, 215, 0, 0.4),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .action-btn:hover::before {
            opacity: 1;
        }

        .action-btn:hover::after {
            left: 100%;
        }

        .action-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Premium Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            animation: modalFadeIn 0.5s ease;
        }

        @keyframes modalFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            backdrop-filter: blur(20px);
            border: 3px solid transparent;
            background-clip: padding-box;
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            animation: modalSlideIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes modalSlideIn {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple));
            border-radius: 30px;
            z-index: -1;
            animation: modalBorder 3s ease-in-out infinite alternate;
        }

        @keyframes modalBorder {
            0% { filter: blur(4px) brightness(1); }
            100% { filter: blur(6px) brightness(1.3); }
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange));
            color: #000;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 100;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 
                0 10px 30px rgba(255, 215, 0, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
            animation: notificationSlide 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                       notificationFadeOut 0.6s ease 2.5s forwards;
        }

        @keyframes notificationSlide {
            0% { 
                top: -100px; 
                opacity: 0; 
                transform: translateX(-50%) scale(0.8); 
            }
            100% { 
                top: 30px; 
                opacity: 1; 
                transform: translateX(-50%) scale(1); 
            }
        }

        @keyframes notificationFadeOut {
            0% { 
                opacity: 1; 
                top: 30px; 
                transform: translateX(-50%) scale(1); 
            }
            100% { 
                opacity: 0; 
                top: -100px; 
                transform: translateX(-50%) scale(0.8); 
            }
        }

        /* Loading Screen */
        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-gold);
            animation: loading 1s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        @keyframes loading {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Leaderboard Styles */
        .leaderboard {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            backdrop-filter: blur(20px);
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 25px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .leaderboard::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange));
            border-radius: 25px;
            z-index: -1;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            margin: 10px 0;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 107, 53, 0.05));
            border-radius: 15px;
            border-left: 4px solid var(--primary-gold);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .leaderboard-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .leaderboard-entry:hover::before {
            left: 100%;
        }

        .leaderboard-entry.top-3 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 53, 0.2));
            border-left-color: var(--secondary-orange);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .leaderboard-entry:hover {
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        /* Shop Grid Enhancement */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            padding: 15px 0;
        }

        .shop-item {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            backdrop-filter: blur(20px);
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 25px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
        }

        .shop-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange), var(--accent-purple));
            border-radius: 25px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .shop-item:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.4);
        }

        .shop-item:hover::before {
            opacity: 1;
        }

        .shop-item div:first-child {
            font-size: 50px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }

        .shop-item:hover div:first-child {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
        }

        /* Boss Raid Enhancement */
        .boss-image {
            width: 220px;
            height: 220px;
            background: radial-gradient(circle, var(--accent-purple), #4a148c, #1a0033);
            border-radius: 30px;
            margin: 25px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            border: 4px solid transparent;
            background-clip: padding-box;
            animation: bossPulse 2s infinite alternate;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 15px 50px rgba(114, 9, 183, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .boss-image::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(45deg, var(--danger-red), var(--accent-purple), var(--primary-gold));
            border-radius: 30px;
            z-index: -1;
            animation: bossAura 3s ease-in-out infinite alternate;
        }

        @keyframes bossPulse {
            0% { 
                transform: scale(1);
                box-shadow: 
                    0 15px 50px rgba(114, 9, 183, 0.6),
                    inset 0 0 30px rgba(255, 255, 255, 0.1);
            }
            100% { 
                transform: scale(1.05);
                box-shadow: 
                    0 20px 60px rgba(114, 9, 183, 0.8),
                    inset 0 0 40px rgba(255, 255, 255, 0.2);
            }
        }

        @keyframes bossAura {
            0% { filter: blur(6px) brightness(1); }
            100% { filter: blur(10px) brightness(1.5); }
        }

        .boss-image:hover {
            transform: scale(1.1);
        }

        .boss-image:active {
            transform: scale(0.95);
            animation: bossHit 0.2s ease;
        }

        @keyframes bossHit {
            0% { filter: brightness(2) saturate(2); }
            100% { filter: brightness(1) saturate(1); }
        }

        .boss-health {
            width: 100%;
            height: 35px;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(139, 0, 0, 0.3));
            border: 3px solid transparent;
            background-clip: padding-box;
            border-radius: 20px;
            overflow: hidden;
            margin: 25px 0;
            position: relative;
            box-shadow: 
                0 6px 20px rgba(255, 0, 0, 0.3),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
        }

        .boss-health::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--danger-red), #8B0000);
            border-radius: 20px;
            z-index: -1;
        }

        .boss-health-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger-red), var(--secondary-orange), var(--primary-gold));
            transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 20px rgba(255, 0, 0, 0.6),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .boss-health-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: healthPulse 2s infinite;
        }

        @keyframes healthPulse {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Daily Reward Enhancement */
        .daily-reward {
            background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange));
            border-radius: 25px;
            padding: 25px;
            text-align: center;
            margin: 15px 0;
            color: #000;
            font-weight: 700;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 30px rgba(255, 215, 0, 0.5),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
            animation: dailyGlow 3s ease-in-out infinite alternate;
        }

        @keyframes dailyGlow {
            0% { 
                box-shadow: 
                    0 10px 30px rgba(255, 215, 0, 0.5),
                    inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            100% { 
                box-shadow: 
                    0 15px 40px rgba(255, 215, 0, 0.7),
                    inset 0 0 30px rgba(255, 255, 255, 0.4);
            }
        }

        .streak-counter {
            font-size: 28px;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* User Info Enhancement */
        .tg-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 107, 53, 0.05));
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.2),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
        }

        .tg-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid var(--primary-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            transition: all 0.3s ease;
        }

        .tg-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
        }

        /* Minigame Area Enhancement */
        .minigame-area {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            backdrop-filter: blur(20px);
            border: 3px solid transparent;
            background-clip: padding-box;
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.3),
                inset 0 0 25px rgba(255, 255, 255, 0.1);
        }

        .minigame-area::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--neon-blue), var(--accent-purple), var(--primary-gold));
            border-radius: 25px;
            z-index: -1;
            animation: gameAreaGlow 4s ease-in-out infinite alternate;
        }

        @keyframes gameAreaGlow {
            0% { filter: blur(6px) brightness(1); }
            100% { filter: blur(10px) brightness(1.3); }
        }

        /* Close Button Enhancement */
        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: linear-gradient(135deg, var(--danger-red), #8B0000);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
        }

        .close-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.5);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .resources {
                gap: 10px;
            }
            
            .resource {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .galaxy-map {
                gap: 15px;
                padding: 15px 0;
            }
            
            .planet-info div:first-child {
                font-size: 16px;
            }
            
            .planet-info div:last-child {
                font-size: 10px;
            }
            
            .mining-area {
                width: 240px;
                height: 240px;
            }
            
            .action-btn {
                padding: 12px 20px;
                font-size: 14px;
                min-width: 120px;
            }
            
            .boss-image {
                width: 180px;
                height: 180px;
                font-size: 60px;
            }
            
            .shop-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
            }
            
            .shop-item {
                padding: 15px;
            }
            
            .shop-item div:first-child {
                font-size: 40px;
                margin-bottom: 10px;
            }
        }

        /* Screen-specific animations */
        .screen.active .planet {
            animation: planetEntry 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .screen.active .planet:nth-child(1) { animation-delay: 0.1s; }
        .screen.active .planet:nth-child(2) { animation-delay: 0.2s; }
        .screen.active .planet:nth-child(3) { animation-delay: 0.3s; }
        .screen.active .planet:nth-child(4) { animation-delay: 0.4s; }
        .screen.active .planet:nth-child(5) { animation-delay: 0.5s; }
        .screen.active .planet:nth-child(6) { animation-delay: 0.6s; }

        @keyframes planetEntry {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(50px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Enhanced Starfield Background -->
        <div class="stars" id="starfield"></div>

        <!-- Loading Screen -->
        <div class="screen active" id="loadingScreen">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                <div class="logo" style="font-size: 48px; margin-bottom: 30px; animation: logoFloat 3s ease-in-out infinite alternate;">CX ODYSSEY</div>
                <div style="font-size: 20px; margin-bottom: 40px; opacity: 0.9;">Loading game...</div>
                <div class="loading"></div>
                <div id="tgInitStatus" style="margin-top: 30px; font-size: 16px; color: var(--primary-gold);">
                    Initializing Telegram WebApp
                </div>
            </div>
        </div>

        <!-- Main Galaxy Map Screen -->
        <div class="screen" id="galaxyScreen">
            <div class="header">
                <div class="logo">CX ODYSSEY</div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energy">100</span></div>
                    <div class="resource">üíé <span id="shards">0</span></div>
                    <div class="resource">üèÜ <span id="gp">0</span></div>
                </div>
            </div>
            
            <div class="tg-user-info" id="tgUserInfo">
                <img class="tg-avatar" id="tgAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FFD700'/%3E%3Ctext x='50' y='65' text-anchor='middle' font-size='40' fill='%23000'%3Eüë§%3C/text%3E%3C/svg%3E">
                <div>
                    <div id="tgUserName" style="font-weight: 700; font-size: 18px;">Player</div>
                    <div style="font-size: 14px; opacity: 0.8;">Level <span id="tgUserLevel">1</span> Explorer</div>
                </div>
            </div>
            
            <div class="daily-reward" id="dailyReward">
                <div style="font-size: 20px; margin-bottom: 10px;">üéÅ Daily Login Bonus!</div>
                <div class="streak-counter">Day <span id="streakDay">1</span> Streak</div>
                <div style="font-size: 18px;">+<span id="bonusAmount">100</span> GP Earned!</div>
            </div>

            <div class="galaxy-map">
                <div class="planet planet-1" onclick="selectPlanet('Pyrion', 1)">
                    <div class="planet-info">
                        <div>üî• Pyrion</div>
                        <div>Fire World</div>
                    </div>
                </div>
                <div class="planet planet-2" onclick="selectPlanet('Aqueos', 2)">
                    <div class="planet-info">
                        <div>üåä Aqueos</div>
                        <div>Ocean World</div>
                    </div>
                </div>
                <div class="planet planet-3" onclick="selectPlanet('Voidex', 3)">
                    <div class="planet-info">
                        <div>üåå Voidex</div>
                        <div>Dark Matter</div>
                    </div>
                </div>
                <div class="planet planet-4" onclick="selectPlanet('Verdant', 4)">
                    <div class="planet-info">
                        <div>üåø Verdant</div>
                        <div>Bio World</div>
                    </div>
                </div>
                <div class="planet planet-5" onclick="selectPlanet('Aurelia', 5)">
                    <div class="planet-info">
                        <div>‚ú® Aurelia</div>
                        <div>Gold Planet</div>
                    </div>
                </div>
                <div class="planet planet-6" onclick="selectPlanet('Crimson', 6)">
                    <div class="planet-info">
                        <div>‚öîÔ∏è Crimson</div>
                        <div>War Zone</div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('bossScreen')">üêâ Boss Raid</button>
                <button class="action-btn" onclick="checkDailyReward()">üéÅ Daily Login</button>
                <button class="action-btn" onclick="shareGame()">üì§ Share Game</button>
            </div>
        </div>

        <!-- Mining Screen -->
        <div class="screen" id="miningScreen">
            <div class="header">
                <div class="logo">MINING: <span id="currentPlanet">Planet</span></div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energyMining">100</span></div>
                    <div class="resource">üíé <span id="shardsMining">0</span></div>
                </div>
            </div>

            <div class="mining-screen">
                <div class="mining-area" onclick="minePlanet()">
                    <div style="text-align: center; z-index: 2; position: relative;">
                        <div style="font-size: 32px; margin-bottom: 15px;">‚õèÔ∏è</div>
                        <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">TAP TO MINE</div>
                        <div style="font-size: 14px; opacity: 0.9;">+<span id="mineReward">10</span> Shards</div>
                    </div>
                </div>

                <div style="width: 100%; max-width: 320px;">
                    <div style="margin-bottom: 15px; font-size: 16px; font-weight: 600;">Energy: <span id="energyText">100/100</span></div>
                    <div class="energy-bar">
                        <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="watchAdForEnergy()" id="adBtn">üì∫ Watch Ad (+50 Energy)</button>
                    <button class="action-btn" onclick="battleAliens()">‚öîÔ∏è Battle Aliens</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>
            </div>
        </div>

        <!-- Boss Raid Screen -->
        <div class="screen" id="bossScreen">
            <div class="header">
                <div class="logo">BOSS RAID</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpBoss">0</span></div>
                    <div class="resource">‚öîÔ∏è <span id="damage">0</span></div>
                </div>
            </div>

            <div class="boss-raid">
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 24px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">üêâ COSMIC OVERLORD</h2>
                
                <div class="boss-image" onclick="attackBoss()">
                    üëπ
                </div>

                <div>
                    <div style="margin-bottom: 15px; font-size: 18px; font-weight: 600;">Boss Health: <span id="bossHealthText">1000/1000</span></div>
                    <div class="boss-health">
                        <div class="boss-health-fill" id="bossHealthFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="attackBoss()">‚öîÔ∏è ATTACK! (Tap)</button>
                    <button class="action-btn" onclick="watchAdForDamage()">üì∫ Watch Ad (2x Damage)</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>

                <div style="margin-top: 25px; font-size: 16px; opacity: 0.9; background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 15px;">
                    Your Damage: <span id="playerDamage" style="color: var(--primary-gold); font-weight: 700;">0</span><br>
                    Global Progress: <span id="globalProgress" style="color: var(--success-green); font-weight: 700;">0</span>%
                </div>
            </div>
        </div>

        <!-- Leaderboards Screen -->
        <div class="screen" id="leaderboardScreen">
            <div class="header">
                <div class="logo">LEADERBOARDS</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpLeaderboard">0</span></div>
                    <div class="resource">#<span id="playerRank">999</span></div>
                </div>
            </div>

            <div class="leaderboard">
                <h3 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 22px; text-align: center;">üèÜ TOP COLLECTORS</h3>
                <div id="leaderboardEntries">
                    <div class="leaderboard-entry top-3">
                        <div><span style="color: var(--primary-gold); font-size: 24px;">üëë</span> Loading...</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">0 GP</div>
                    </div>
                </div>
                <div class="leaderboard-entry" style="background: rgba(255, 215, 0, 0.3); border: 2px solid var(--primary-gold);">
                    <div style="font-weight: 700;"><span id="leaderboardRank">999</span>. You</div>
                    <div style="font-weight: 700; color: var(--primary-gold);"><span id="leaderboardGP">0</span> GP</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Shop Screen -->
        <div class="screen" id="shopScreen">
            <div class="header">
                <div class="logo">SHOP & UPGRADES</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpShop">0</span></div>
                    <div class="resource">üíé <span id="shardsShop">0</span></div>
                </div>
            </div>

            <div class="shop-grid">
                <div class="shop-item" onclick="buyUpgrade('speed')">
                    <div>üöÄ</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Speed Boost</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">500 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+25% Mining Speed</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('damage')">
                    <div>‚öîÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Damage Boost</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">750 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+50% Battle Damage</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('energy')">
                    <div>‚ö°</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Energy Tank</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">1000 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+50 Max Energy</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('skin1')">
                    <div style="color: #333;">üöÄ</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Black Ship</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">2000 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Premium Skin</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('skin2')">
                    <div style="color: var(--primary-gold);">üöÄ</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Gold Ship</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">5000 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Legendary Skin</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('multiplier')">
                    <div>üí∞</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">GP Multiplier</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;">3000 GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+100% GP Gain</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Mini-Games Screen -->
        <div class="screen" id="minigamesScreen">
            <div class="header">
                <div class="logo">MINI-GAMES HUB</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpMinigames">0</span></div>
                    <div class="resource">üéÆ <span id="gameScore">0</span></div>
                </div>
            </div>

            <div class="shop-grid">
                <div class="shop-item" onclick="startAsteroidDodge()">
                    <div>‚òÑÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Asteroid Dodge</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Survive the asteroid field!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 300-1000 GP</div>
                </div>
                <div class="shop-item" onclick="startCryptoClicker()">
                    <div>üíé</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Crypto Clicker</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Click as fast as you can!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 200-800 GP</div>
                </div>
                <div class="shop-item" onclick="startPuzzleHack()">
                    <div>üß©</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Puzzle Hack</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Solve alien puzzles!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 100-500 GP</div>
                </div>
                <div class="shop-item" onclick="startPvPArena()">
                    <div>‚öîÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">CX Arena PvP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Battle other players!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 500-2000 GP</div>
                </div>
            </div>

            <div class="minigame-area" id="minigameArea">
                <h3 style="color: var(--primary-gold); font-size: 24px; margin-bottom: 15px;">Select a mini-game to start!</h3>
                <p style="font-size: 16px; opacity: 0.9;">Earn bonus GP and climb the leaderboards</p>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar">
            <button class="nav-btn active" onclick="showScreen('galaxyScreen')">
                <div>üåå</div>
                <div>Galaxy</div>
            </button>
            <button class="nav-btn" onclick="showScreen('leaderboardScreen')">
                <div>üèÜ</div>
                <div>Ranks</div>
            </button>
            <button class="nav-btn" onclick="showScreen('shopScreen')">
                <div>üõí</div>
                <div>Shop</div>
            </button>
            <button class="nav-btn" onclick="showScreen('minigamesScreen')">
                <div>üéÆ</div>
                <div>Games</div>
            </button>
        </div>

        <!-- Modals -->
        <div class="modal" id="adModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('adModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 28px;">üé¨ Watch Ad</h2>
                <p style="font-size: 18px; margin-bottom: 25px;">Watch this short video to get your reward!</p>
                <div style="width: 320px; height: 220px; background: linear-gradient(135deg, #333, #555); border-radius: 20px; margin: 25px auto; display: flex; align-items: center; justify-content: center; font-size: 64px; border: 3px solid var(--primary-gold); box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                    üì∫
                </div>
                <div style="margin: 25px 0;">
                    <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; margin-bottom: 15px;">
                        <div id="adProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary-gold), var(--secondary-orange)); transition: width 0.1s linear; border-radius: 4px;"></div>
                    </div>
                    <div style="font-size: 16px; font-weight: 600;">Ad progress: <span id="adTime" style="color: var(--primary-gold);">0</span>/5 seconds</div>
                </div>
                <button class="action-btn" onclick="skipAd()" id="skipBtn" style="display: none; margin-top: 20px;">‚úÖ Claim Reward</button>
            </div>
        </div>

        <div class="modal" id="rewardModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('rewardModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 32px;">üéâ Reward Earned!</h2>
                <div style="font-size: 80px; margin: 25px 0; animation: rewardBounce 1s ease infinite alternate;">üíé</div>
                <div style="font-size: 28px; color: var(--primary-gold); font-weight: 700; margin-bottom: 20px;" id="rewardText">+100 GP</div>
                <p style="margin-top: 25px; font-size: 16px; opacity: 0.9;">Keep collecting to unlock more rewards!</p>
                <button class="action-btn" onclick="closeModal('rewardModal')" style="margin-top: 25px;">Continue</button>
            </div>
        </div>

        <div class="modal" id="upgradeModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('upgradeModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 32px;">üöÄ Upgrade Complete!</h2>
                <div style="font-size: 80px; margin: 25px 0; animation: upgradeGlow 2s ease-in-out infinite alternate;" id="upgradeIcon">‚ö°</div>
                <div style="font-size: 20px; margin-bottom: 20px; font-weight: 600;" id="upgradeText">Speed boost activated!</div>
                <p style="margin-top: 25px; font-size: 16px; opacity: 0.9;">Your ship is now more powerful!</p>
                <button class="action-btn" onclick="closeModal('upgradeModal')" style="margin-top: 25px;">Awesome!</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes logoFloat {
                0% { transform: translateY(0px) scale(1); }
                100% { transform: translateY(-10px) scale(1.02); }
            }
            
            @keyframes rewardBounce {
                0% { transform: scale(1) rotate(0deg); }
                100% { transform: scale(1.1) rotate(5deg); }
            }
            
            @keyframes upgradeGlow {
                0% { 
                    filter: drop-shadow(0 0 10px var(--primary-gold)) brightness(1); 
                    transform: scale(1);
                }
                100% { 
                    filter: drop-shadow(0 0 30px var(--primary-gold)) brightness(1.3); 
                    transform: scale(1.05);
                }
            }
        `;
        document.head.appendChild(style);

        // Telegram WebApp initialization
        let tg = window.Telegram.WebApp;
        let user = null;
        
        // Game State
        let gameState = {
            energy: 100,
            maxEnergy: 100,
            shards: 0,
            gp: 0,
            currentPlanet: '',
            dailyStreak: 1,
            lastLogin: '',
            bossHealth: 1000,
            maxBossHealth: 1000,
            playerDamage: 0,
            upgrades: {
                speed: 0,
                damage: 0,
                energy: 0,
                multiplier: 0
            },
            skins: [],
            achievements: []
        };

        // Initialize game
        function initGame() {
            generateEnhancedStarfield();
            generateFloatingParticles();
            
            // Initialize Telegram WebApp
            tg.expand();
            tg.enableClosingConfirmation();
            tg.ready();
            
            // Get user data from Telegram
            user = tg.initDataUnsafe.user;
            
            if (user) {
                document.getElementById('tgInitStatus').textContent = "Welcome, " + user.first_name + "!";
                
                // Update user info in UI
                if (user.photo_url) {
                    document.getElementById('tgAvatar').src = user.photo_url;
                }
                
                let userName = user.first_name;
                if (user.last_name) userName += " " + user.last_name;
                if (user.username) userName += " (@" + user.username + ")";
                
                document.getElementById('tgUserName').textContent = userName;
                
                // Load game state from Telegram backend
                loadGameStateFromTelegram();
            } else {
                document.getElementById('tgInitStatus').textContent = "Telegram WebApp not detected";
                setTimeout(() => {
                    showScreen('galaxyScreen');
                    updateUI();
                    showNotification('üöÄ Welcome to CX Odyssey!');
                }, 2000);
            }
        }

        // Enhanced starfield generation
        function generateEnhancedStarfield() {
            const starfield = document.getElementById('starfield');
            const starTypes = ['star-small', 'star-medium', 'star-large'];
            
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                const type = starTypes[Math.floor(Math.random() * starTypes.length)];
                star.className = `star ${type}`;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (2 + Math.random() * 2) + 's';
                starfield.appendChild(star);
            }
        }

        // Generate floating particles
        function generateFloatingParticles() {
            setInterval(() => {
                if (Math.random() < 0.3) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                    document.querySelector('.game-container').appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 10000);
                }
            }, 1000);
        }

        // API Service Functions for Telegram
        async function telegramApiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'X-Telegram-Bot-Token': tg.initData
                }
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                // Replace with your actual Telegram bot API endpoint
                const response = await fetch(`https://your-telegram-bot-api.com${endpoint}`, options);
                return await response.json();
            } catch (error) {
                console.error('Telegram API call failed:', error);
                throw error;
            }
        }

        // Load game state from Telegram backend
        async function loadGameStateFromTelegram() {
            try {
                if (user) {
                    const data = await telegramApiCall(`/game/state/${user.id}`);
                    gameState = { ...gameState, ...data };
                }
                
                updateUI();
                checkDailyLogin();
                
                setTimeout(() => {
                    showScreen('galaxyScreen');
                    showNotification(`üöÄ Welcome back, ${user.first_name}!`);
                }, 1500);
                
            } catch (error) {
                // Fallback to default state
                setTimeout(() => {
                    showScreen('galaxyScreen');
                    showNotification('üöÄ Welcome to CX Odyssey!');
                    updateUI();
                }, 1500);
            }
        }

        // Save game state to Telegram backend
        async function saveGameStateToTelegram() {
            try {
                if (user) {
                    await telegramApiCall(`/game/state/${user.id}`, 'POST', gameState);
                }
            } catch (error) {
                console.error('Failed to save game state:', error);
            }
        }

        // Share game via Telegram
        function shareGame() {
            const shareText = `üöÄ Join me in CX Odyssey - an amazing space mining adventure! 

üåå Explore alien worlds
‚õèÔ∏è Mine cosmic resources  
üêâ Battle epic bosses
üèÜ Compete on leaderboards

Start your cosmic journey now!`;

            const shareUrl = `https://t.me/share/url?url=https://t.me/YourCXOdysseyBot/game&text=${encodeURIComponent(shareText)}`;
            
            if (tg.openTelegramLink) {
                tg.openTelegramLink(shareUrl);
            } else {
                window.open(shareUrl, '_blank');
            }
            
            showNotification('üéâ Thanks for sharing CX Odyssey!');
        }

        // Screen management with enhanced animations
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            setTimeout(() => {
                document.getElementById(screenId).classList.add('active');
            }, 100);

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const navMap = {
                'galaxyScreen': 0,
                'leaderboardScreen': 1,
                'shopScreen': 2,
                'minigamesScreen': 3
            };
            
            if (navMap[screenId] !== undefined) {
                document.querySelectorAll('.nav-btn')[navMap[screenId]].classList.add('active');
            }

            if (screenId === 'leaderboardScreen') {
                loadLeaderboard();
            }

            updateUI();
        }

        // Planet selection with enhanced effects
        function selectPlanet(planetName, planetId) {
            gameState.currentPlanet = planetName;
            document.getElementById('currentPlanet').textContent = planetName;
            document.getElementById('mineReward').textContent = planetId * 5 + 5;
            showScreen('miningScreen');
            showNotification(`üåç Landed on ${planetName}!`);
            
            // Haptic feedback if available
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        // Enhanced mining mechanics
        async function minePlanet() {
            if (gameState.energy <= 0) {
                showNotification('‚ö° No energy! Watch an ad or wait for regeneration.');
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            const currentPlanetElement = document.getElementById('currentPlanet');
            const planetName = currentPlanetElement.textContent;
            const planetMultiplier = getPlanetMultiplier(planetName);
            const speedBonus = 1 + (gameState.upgrades.speed * 0.25);
            const reward = Math.floor((10 + Math.random() * 10) * planetMultiplier * speedBonus);

            gameState.energy -= 5;
            gameState.shards += reward;
            gameState.gp += Math.floor(reward * 0.5 * (1 + gameState.upgrades.multiplier));

            // Enhanced mining beam effect
            const miningArea = document.querySelector('.mining-area');
            const beam = document.createElement('div');
            beam.className = 'mining-beam';
            miningArea.appendChild(beam);

            // Add screen shake effect
            miningArea.style.animation = 'none';
            setTimeout(() => {
                miningArea.style.animation = 'miningShake 0.5s ease-out';
            }, 100);

            setTimeout(() => {
                beam.remove();
                miningArea.style.animation = '';
            }, 1200);

            // Haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }

            showNotification(`üíé +${reward} Shards, +${Math.floor(reward * 0.5 * (1 + gameState.upgrades.multiplier))} GP!`);
            updateUI();
            await saveGameStateToTelegram();
        }

        // Add mining shake animation
        const miningStyle = document.createElement('style');
        miningStyle.textContent = `
            @keyframes miningShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px) scale(1.02); }
                75% { transform: translateX(5px) scale(1.02); }
            }
        `;
        document.head.appendChild(miningStyle);

        function getPlanetMultiplier(planetName) {
            const multipliers = {
                'Pyrion': 1.2,
                'Aqueos': 1.0,
                'Voidex': 1.8,
                'Verdant': 1.1,
                'Aurelia': 2.0,
                'Crimson': 1.5
            };
            return multipliers[planetName] || 1.0;
        }

        // Enhanced battle system
        async function battleAliens() {
            if (gameState.energy < 10) {
                showNotification('‚ö° Need at least 10 energy to battle!');
                return;
            }

            gameState.energy -= 10;
            const baseDamage = 50 + (gameState.upgrades.damage * 25);
            const damage = baseDamage + Math.floor(Math.random() * baseDamage * 0.5);
            const reward = Math.floor((100 + Math.random() * 200) * (1 + gameState.upgrades.multiplier));
            
            gameState.gp += reward;
            
            // Haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('heavy');
            }
            
            showNotification(`‚öîÔ∏è Defeated aliens! +${reward} GP!`);
            updateUI();
            await saveGameStateToTelegram();
        }

        // Enhanced boss raid system
        async function attackBoss() {
            const baseDamage = 10 + (gameState.upgrades.damage * 5);
            const damage = baseDamage + Math.floor(Math.random() * 20);
            const actualDamage = gameState.adDamageBoost > 0 ? damage * 2 : damage;
            
            gameState.bossHealth = Math.max(0, gameState.bossHealth - actualDamage);
            gameState.playerDamage += actualDamage;
            
            if (gameState.adDamageBoost > 0) {
                gameState.adDamageBoost--;
            }

            // Enhanced boss hit effect
            const bossImage = document.querySelector('.boss-image');
            bossImage.style.animation = 'none';
            setTimeout(() => {
                bossImage.style.animation = 'bossHit 0.2s ease, bossPulse 2s infinite alternate 0.2s';
            }, 10);

            if (gameState.bossHealth <= 0) {
                const reward = 5000;
                gameState.gp += reward;
                gameState.bossHealth = gameState.maxBossHealth;
                gameState.playerDamage = 0;
                
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
                
                showNotification(`üêâ Boss defeated! +${reward} GP!`);
            } else {
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('medium');
                }
                
                showNotification(`‚öîÔ∏è Hit for ${actualDamage} damage!`);
            }

            updateUI();
            await saveGameStateToTelegram();
        }

        // Enhanced ad system
        function watchAdForEnergy() {
            showModal('adModal');
            startAdTimer(async () => {
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 50);
                closeModal('adModal');
                showRewardModal('‚ö° +50 Energy!', '‚ö°');
                updateUI();
                await saveGameStateToTelegram();
            });
        }

        function watchAdForDamage() {
            showModal('adModal');
            startAdTimer(async () => {
                gameState.adDamageBoost = 3;
                closeModal('adModal');
                showRewardModal('‚öîÔ∏è 2x Damage for next 3 attacks!', '‚öîÔ∏è');
                await saveGameStateToTelegram();
            });
        }

        function startAdTimer(callback) {
            let timeLeft = 5;
            const progressBar = document.getElementById('adProgress');
            const timeDisplay = document.getElementById('adTime');
            const skipBtn = document.getElementById('skipBtn');

            const timer = setInterval(() => {
                timeLeft--;
                const progress = ((5 - timeLeft) / 5) * 100;
                progressBar.style.width = progress + '%';
                timeDisplay.textContent = 5 - timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    skipBtn.style.display = 'block';
                    skipBtn.onclick = callback;
                }
            }, 1000);
        }

        function skipAd() {
            const skipBtn = document.getElementById('skipBtn');
            if (skipBtn.onclick) {
                skipBtn.onclick();
            }
        }

        // Enhanced daily rewards system
        async function checkDailyLogin() {
            const today = new Date().toDateString();
            if (gameState.lastLogin !== today) {
                const streakBonus = gameState.dailyStreak * 100;
                gameState.gp += streakBonus;
                gameState.dailyStreak++;
                gameState.lastLogin = today;

                document.getElementById('streakDay').textContent = gameState.dailyStreak;
                document.getElementById('bonusAmount').textContent = streakBonus;
                
                setTimeout(() => {
                    document.getElementById('dailyReward').style.display = 'none';
                }, 8000);

                updateUI();
                await saveGameStateToTelegram();
            } else {
                document.getElementById('dailyReward').style.display = 'none';
            }
        }

        function checkDailyReward() {
            checkDailyLogin();
            if (document.getElementById('dailyReward').style.display === 'none') {
                showNotification('üéÅ Already claimed today! Come back tomorrow.');
            }
        }

        // Enhanced shop system
        async function buyUpgrade(upgradeType) {
            const costs = {
                speed: 500 * (gameState.upgrades.speed + 1),
                damage: 750 * (gameState.upgrades.damage + 1),
                energy: 1000 * (gameState.upgrades.energy + 1),
                skin1: 2000,
                skin2: 5000,
                multiplier: 3000 * (gameState.upgrades.multiplier + 1)
            };

            const cost = costs[upgradeType];
            if (gameState.gp < cost) {
                showNotification('üèÜ Not enough GP!');
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            gameState.gp -= cost;

            if (upgradeType.startsWith('skin')) {
                if (!gameState.skins.includes(upgradeType)) {
                    gameState.skins.push(upgradeType);
                    showUpgradeModal('üöÄ', `${upgradeType === 'skin1' ? 'Black' : 'Gold'} ship skin unlocked!`);
                } else {
                    gameState.gp += cost;
                    showNotification('üöÄ You already own this skin!');
                    return;
                }
            } else {
                gameState.upgrades[upgradeType]++;
                
                if (upgradeType === 'energy') {
                    gameState.maxEnergy += 50;
                    gameState.energy = gameState.maxEnergy;
                }

                const messages = {
                    speed: 'Mining speed increased!',
                    damage: 'Combat damage boosted!',
                    energy: 'Maximum energy increased!',
                    multiplier: 'GP multiplier activated!'
                };

                showUpgradeModal('‚ö°', messages[upgradeType]);
            }

            if (tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }

            updateUI();
            await saveGameStateToTelegram();
        }

        // Leaderboard system
        async function loadLeaderboard() {
            try {
                const leaderboard = await telegramApiCall('/leaderboard');
                const entriesContainer = document.getElementById('leaderboardEntries');
                entriesContainer.innerHTML = '';
                
                leaderboard.forEach((entry, index) => {
                    const entryEl = document.createElement('div');
                    entryEl.className = `leaderboard-entry ${index < 3 ? 'top-3' : ''}`;
                    
                    let rankIcon = '';
                    if (index === 0) rankIcon = '<span style="color: #ffd700; font-size: 24px;">üëë</span> ';
                    else if (index === 1) rankIcon = '<span style="color: #ff6b35; font-size: 20px;">ü•à</span> ';
                    else if (index === 2) rankIcon = '<span style="color: #7209b7; font-size: 20px;">ü•â</span> ';
                    else rankIcon = `<span style="color: #888;">${index + 1}.</span> `;
                    
                    entryEl.innerHTML = `
                        <div style="font-weight: 600;">${rankIcon}${entry.username}</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">${entry.gp.toLocaleString()} GP</div>
                    `;
                    
                    entriesContainer.appendChild(entryEl);
                });
            } catch (error) {
                document.getElementById('leaderboardEntries').innerHTML = `
                    <div class="leaderboard-entry top-3">
                        <div style="font-weight: 600;"><span style="color: #ffd700; font-size: 24px;">üëë</span> GalaxyMaster</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">125,000 GP</div>
                    </div>
                    <div class="leaderboard-entry top-3">
                        <div style="font-weight: 600;"><span style="color: #ff6b35; font-size: 20px;">ü•à</span> StarHunter</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">89,500 GP</div>
                    </div>
                    <div class="leaderboard-entry top-3">
                        <div style="font-weight: 600;"><span style="color: #7209b7; font-size: 20px;">ü•â</span> CosmicRider</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">67,200 GP</div>
                    </div>
                `;
            }
        }

        // Enhanced Mini-games
        function startAsteroidDodge() {
            const gameArea = document.getElementById('minigameArea');
            gameArea.innerHTML = `
                <h3 style="color: var(--primary-gold); font-size: 22px; margin-bottom: 20px;">‚òÑÔ∏è Asteroid Dodge</h3>
                <p style="margin-bottom: 20px;">Use touch controls to dodge asteroids!</p>
                <div id="dodgeGame" style="position: relative; width: 320px; height: 400px; background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(26,26,46,0.8)); border: 3px solid var(--neon-blue); margin: 20px auto; overflow: hidden; border-radius: 20px; box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);">
                    <div id="playerShip" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; background: linear-gradient(45deg, var(--primary-gold), var(--secondary-orange)); border-radius: 50% 50% 0 0; transition: left 0.1s ease; box-shadow: 0 0 15px var(--primary-gold);"></div>
                </div>
                <div style="margin: 20px 0;">
                    <div>Score: <span id="dodgeScore" style="color: var(--success-green); font-weight: 700; font-size: 18px;">0</span></div>
                    <div>Time: <span id="dodgeTime" style="color: var(--primary-gold); font-weight: 700;">30</span>s</div>
                </div>
                <button class="action-btn" onclick="endMinigame()" style="margin-top: 15px;">üõë End Game</button>
            `;

            let score = 0;
            let timeLeft = 30;
            let gameActive = true;
            const gameContainer = document.getElementById('dodgeGame');
            const playerShip = document.getElementById('playerShip');
            const scoreElement = document.getElementById('dodgeScore');
            const timeElement = document.getElementById('dodgeTime');
            
            // Touch controls for ship movement
            let shipPosition = 50;
            gameContainer.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const rect = gameContainer.getBoundingClientRect();
                const touchX = e.touches[0].clientX - rect.left;
                shipPosition = (touchX / rect.width) * 100;
                shipPosition = Math.max(10, Math.min(90, shipPosition));
                playerShip.style.left = shipPosition + '%';
            });

            // Game timer
            const timer = setInterval(() => {
                timeLeft--;
                timeElement.textContent = timeLeft;
                
                if (timeLeft <= 0 && gameActive) {
                    gameActive = false;
                    clearInterval(timer);
                    const reward = Math.floor(300 + (score * 10));
                    gameState.gp += reward;
                    showNotification(`‚òÑÔ∏è Game complete! Score: ${score} - +${reward} GP`);
                    updateUI();
                    saveGameStateToTelegram();
                    endMinigame();
                }
            }, 1000);

            // Spawn asteroids
            const asteroidSpawner = setInterval(() => {
                if (!gameActive) {
                    clearInterval(asteroidSpawner);
                    return;
                }

                const asteroid = document.createElement('div');
                asteroid.style.cssText = `
                    position: absolute;
                    width: 25px;
                    height: 25px;
                    background: radial-gradient(circle, #888, #444);
                    border-radius: 50%;
                    top: -25px;
                    left: ${Math.random() * 90}%;
                    box-shadow: 0 0 10px rgba(136, 136, 136, 0.5);
                `;
                gameContainer.appendChild(asteroid);

                let asteroidY = -25;
                const fallInterval = setInterval(() => {
                    asteroidY += 5;
                    asteroid.style.top = asteroidY + 'px';

                    if (asteroidY > 400) {
                        clearInterval(fallInterval);
                        asteroid.remove();
                        if (gameActive) {
                            score += 10;
                            scoreElement.textContent = score;
                        }
                    }
                }, 50);
            }, 800);
        }

        function startCryptoClicker() {
            const gameArea = document.getElementById('minigameArea');
            let clicks = 0;
            let timeLeft = 10;
            let gameActive = true;

            gameArea.innerHTML = `
                <h3 style="color: var(--primary-gold); font-size: 22px; margin-bottom: 20px;">üíé Crypto Clicker</h3>
                <p style="margin-bottom: 20px;">Click as fast as you can in ${timeLeft} seconds!</p>
                <div id="clickTarget" style="font-size: 120px; cursor: pointer; margin: 30px; transition: all 0.1s ease; filter: drop-shadow(0 0 20px var(--primary-gold));" onclick="clickCrypto()">üíé</div>
                <div style="margin: 20px 0;">
                    <div>Clicks: <span id="clickCount" style="color: var(--success-green); font-weight: 700; font-size: 24px;">0</span></div>
                    <div>Time: <span id="clickTime" style="color: var(--danger-red); font-weight: 700; font-size: 20px;">10</span>s</div>
                </div>
                <div id="clickMultiplier" style="color: var(--neon-blue); font-weight: 600; margin-top: 10px;">1x Multiplier</div>
            `;

            const clickTarget = document.getElementById('clickTarget');
            let multiplier = 1;
            let consecutiveClicks = 0;

            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('clickTime').textContent = timeLeft;

                if (timeLeft <= 0) {
                    gameActive = false;
                    clearInterval(timer);
                    const reward = clicks * 10;
                    gameState.gp += reward;
                    showNotification(`üíé ${clicks} clicks! +${reward} GP`);
                    updateUI();
                    saveGameStateToTelegram();
                    endMinigame();
                }
            }, 1000);

            window.clickCrypto = () => {
                if (!gameActive) return;
                
                clicks += multiplier;
                consecutiveClicks++;
                
                // Increase multiplier for consecutive clicks
                if (consecutiveClicks % 5 === 0) {
                    multiplier = Math.min(5, multiplier + 1);
                    document.getElementById('clickMultiplier').textContent = multiplier + 'x Multiplier';
                }
                
                document.getElementById('clickCount').textContent = clicks;
                
                // Visual feedback
                clickTarget.style.transform = 'scale(0.9)';
                clickTarget.style.filter = 'drop-shadow(0 0 30px var(--primary-gold)) brightness(1.5)';
                
                setTimeout(() => {
                    clickTarget.style.transform = 'scale(1)';
                    clickTarget.style.filter = 'drop-shadow(0 0 20px var(--primary-gold)) brightness(1)';
                }, 100);

                // Haptic feedback
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            };

            // Reset multiplier if no clicks for 2 seconds
            let lastClickTime = Date.now();
            setInterval(() => {
                if (Date.now() - lastClickTime > 2000) {
                    multiplier = 1;
                    consecutiveClicks = 0;
                    document.getElementById('clickMultiplier').textContent = '1x Multiplier';
                }
            }, 500);
        }

        function startPuzzleHack() {
            const gameArea = document.getElementById('minigameArea');
            const targetSequence = Array.from({length: 4}, () => Math.floor(Math.random() * 9) + 1);
            
            gameArea.innerHTML = `
                <h3 style="color: var(--primary-gold); font-size: 22px; margin-bottom: 20px;">üß© Puzzle Hack</h3>
                <p style="margin-bottom: 20px;">Crack the alien security code!</p>
                <div style="background: rgba(0,0,0,0.8); padding: 25px; border-radius: 20px; border: 2px solid var(--neon-blue); margin: 20px 0;">
                    <div style="font-size: 32px; margin: 20px 0; font-family: 'Orbitron', monospace; letter-spacing: 10px; color: var(--neon-blue);">
                        ${targetSequence.join(' ')}
                    </div>
                </div>
                <input type="number" placeholder="Enter 4-digit code" id="puzzleInput" style="padding: 15px 20px; font-size: 20px; border-radius: 15px; border: 2px solid var(--primary-gold); background: rgba(0,0,0,0.8); color: white; width: 200px; text-align: center; margin: 20px;">
                <div style="margin: 20px 0;">
                    <button class="action-btn" onclick="solvePuzzle()" style="margin: 10px;">üîç Crack Code</button>
                    <button class="action-btn" onclick="endMinigame()">üõë Give Up</button>
                </div>
                <div id="puzzleHint" style="color: var(--secondary-orange); margin-top: 15px; font-weight: 600;"></div>
            `;

            window.solvePuzzle = async () => {
                const input = document.getElementById('puzzleInput').value;
                const hintElement = document.getElementById('puzzleHint');
                
                if (input.length !== 4) {
                    hintElement.textContent = '‚ö†Ô∏è Code must be exactly 4 digits!';
                    return;
                }

                const userSequence = input.split('').map(Number);
                const correct = JSON.stringify(userSequence) === JSON.stringify(targetSequence);
                
                if (correct) {
                    const reward = Math.floor(400 + Math.random() * 200);
                    gameState.gp += reward;
                    showNotification(`üß© Code cracked! +${reward} GP`);
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    
                    updateUI();
                    await saveGameStateToTelegram();
                    endMinigame();
                } else {
                    hintElement.textContent = '‚ùå Wrong code! Try again...';
                    document.getElementById('puzzleInput').value = '';
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('error');
                    }
                }
            };
        }

        function startPvPArena() {
            const gameArea = document.getElementById('minigameArea');
            let playerHealth = 100;
            let enemyHealth = 100;
            
            gameArea.innerHTML = `
                <h3 style="color: var(--primary-gold); font-size: 22px; margin-bottom: 20px;">‚öîÔ∏è CX Arena PvP</h3>
                <p style="margin-bottom: 20px;">Battle against GalaxyHunter!</p>
                <div style="display: flex; justify-content: space-around; margin: 30px 0; align-items: center;">
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 15px;">üöÄ</div>
                        <div style="font-weight: 700; margin-bottom: 10px;">You</div>
                        <div style="width: 120px; height: 25px; background: rgba(76, 175, 80, 0.3); border-radius: 15px; border: 2px solid var(--success-green); overflow: hidden;">
                            <div id="playerHealthBar" style="width: 100%; height: 100%; background: linear-gradient(90deg, var(--success-green), var(--primary-gold)); border-radius: 13px; transition: width 0.5s ease;"></div>
                        </div>
                        <div id="playerHealthText" style="margin-top: 5px; font-size: 14px;">100/100</div>
                    </div>
                    <div style="font-size: 32px; color: var(--danger-red); font-weight: 900;">VS</div>
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 15px;">ü§ñ</div>
                        <div style="font-weight: 700; margin-bottom: 10px;">GalaxyHunter</div>
                        <div style="width: 120px; height: 25px; background: rgba(255, 68, 68, 0.3); border-radius: 15px; border: 2px solid var(--danger-red); overflow: hidden;">
                            <div id="enemyHealthBar" style="width: 100%; height: 100%; background: linear-gradient(90deg, var(--danger-red), var(--secondary-orange)); border-radius: 13px; transition: width 0.5s ease;"></div>
                        </div>
                        <div id="enemyHealthText" style="margin-top: 5px; font-size: 14px;">100/100</div>
                    </div>
                </div>
                <div style="margin: 30px 0;">
                    <button class="action-btn" onclick="pvpAttack()" style="font-size: 20px; padding: 20px 40px;">‚öîÔ∏è ATTACK!</button>
                    <button class="action-btn" onclick="endMinigame()" style="margin-top: 15px;">üõë Retreat</button>
                </div>
                <div id="battleLog" style="background: rgba(0,0,0,0.6); padding: 15px; border-radius: 15px; max-height: 100px; overflow-y: auto; font-size: 14px;"></div>
            `;

            window.pvpAttack = async () => {
                const playerDamage = 15 + Math.floor(Math.random() * 20);
                const enemyDamage = 10 + Math.floor(Math.random() * 25);
                
                enemyHealth = Math.max(0, enemyHealth - playerDamage);
                playerHealth = Math.max(0, playerHealth - enemyDamage);
                
                // Update health bars
                document.getElementById('enemyHealthBar').style.width = enemyHealth + '%';
                document.getElementById('playerHealthBar').style.width = playerHealth + '%';
                document.getElementById('enemyHealthText').textContent = `${enemyHealth}/100`;
                document.getElementById('playerHealthText').textContent = `${playerHealth}/100`;
                
                // Battle log
                const battleLog = document.getElementById('battleLog');
                battleLog.innerHTML += `<div>You dealt ${playerDamage} damage!</div>`;
                if (enemyHealth > 0) {
                    battleLog.innerHTML += `<div style="color: var(--danger-red);">Enemy dealt ${enemyDamage} damage!</div>`;
                }
                battleLog.scrollTop = battleLog.scrollHeight;
                
                // Check win/lose conditions
                if (enemyHealth <= 0) {
                    const reward = Math.floor(1000 + Math.random() * 1000);
                    gameState.gp += reward;
                    showNotification(`‚öîÔ∏è Victory! +${reward} GP`);
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    
                    updateUI();
                    await saveGameStateToTelegram();
                    endMinigame();
                } else if (playerHealth <= 0) {
                    showNotification(`üíÄ Defeat! Better luck next time.`);
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('error');
                    }
                    
                    endMinigame();
                } else {
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('medium');
                    }
                }
            };
        }

        function endMinigame() {
            document.getElementById('minigameArea').innerHTML = `
                <h3 style="color: var(--primary-gold); font-size: 24px; margin-bottom: 15px;">Select a mini-game to start!</h3>
                <p style="font-size: 16px; opacity: 0.9;">Earn bonus GP and climb the leaderboards</p>
                <div style="font-size: 60px; margin: 20px 0; animation: gameIdle 3s ease-in-out infinite alternate;">üéÆ</div>
            `;
            
            // Clean up global functions
            window.clickCrypto = null;
            window.solvePuzzle = null;
            window.pvpAttack = null;
        }

        // Add game idle animation
        const gameIdleStyle = document.createElement('style');
        gameIdleStyle.textContent = `
            @keyframes gameIdle {
                0% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 10px var(--neon-blue)); }
                100% { transform: scale(1.05) rotate(2deg); filter: drop-shadow(0 0 20px var(--primary-gold)); }
            }
        `;
        document.head.appendChild(gameIdleStyle);

        // Modal system
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showRewardModal(text, icon) {
            document.getElementById('rewardText').textContent = text;
            document.querySelector('#rewardModal .modal-content div:nth-child(3)').textContent = icon;
            showModal('rewardModal');
        }

        function showUpgradeModal(icon, text) {
            document.getElementById('upgradeIcon').textContent = icon;
            document.getElementById('upgradeText').textContent = text;
            showModal('upgradeModal');
        }

        // Enhanced notification system
        function showNotification(text) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = text;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3200);
        }

        // UI updates
        function updateUI() {
            // Update all resource displays
            document.querySelectorAll('#energy, #energyMining').forEach(el => {
                el.textContent = gameState.energy;
            });
            document.querySelectorAll('#shards, #shardsMining, #shardsShop').forEach(el => {
                el.textContent = gameState.shards.toLocaleString();
            });
            document.querySelectorAll('#gp, #gpBoss, #gpLeaderboard, #gpShop, #gpMinigames').forEach(el => {
                el.textContent = gameState.gp.toLocaleString();
            });

            // Update energy bar
            const energyPercent = (gameState.energy / gameState.maxEnergy) * 100;
            const energyFill = document.getElementById('energyFill');
            if (energyFill) {
                energyFill.style.width = energyPercent + '%';
            }
            
            const energyText = document.getElementById('energyText');
            if (energyText) {
                energyText.textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            }

            // Update boss health
            const bossPercent = (gameState.bossHealth / gameState.maxBossHealth) * 100;
            const bossHealthFill = document.getElementById('bossHealthFill');
            if (bossHealthFill) {
                bossHealthFill.style.width = bossPercent + '%';
            }
            
            const bossHealthText = document.getElementById('bossHealthText');
            if (bossHealthText) {
                bossHealthText.textContent = `${gameState.bossHealth}/${gameState.maxBossHealth}`;
            }
            
            const playerDamageEl = document.getElementById('playerDamage');
            if (playerDamageEl) {
                playerDamageEl.textContent = gameState.playerDamage.toLocaleString();
            }

            // Update leaderboard
            const leaderboardGP = document.getElementById('leaderboardGP');
            if (leaderboardGP) {
                leaderboardGP.textContent = gameState.gp.toLocaleString();
            }
            
            const rank = Math.max(1, 1000 - Math.floor(gameState.gp / 100));
            const leaderboardRank = document.getElementById('leaderboardRank');
            const playerRank = document.getElementById('playerRank');
            if (leaderboardRank) leaderboardRank.textContent = rank;
            if (playerRank) playerRank.textContent = rank;

            // Update ad button state
            const adBtn = document.getElementById('adBtn');
            if (adBtn) {
                if (gameState.energy >= gameState.maxEnergy) {
                    adBtn.disabled = true;
                    adBtn.textContent = '‚ö° Energy Full';
                    adBtn.style.opacity = '0.5';
                } else {
                    adBtn.disabled = false;
                    adBtn.textContent = 'üì∫ Watch Ad (+50 Energy)';
                    adBtn.style.opacity = '1';
                }
            }

            // Update user level based on GP
            const userLevel = Math.floor(gameState.gp / 1000) + 1;
            const userLevelEl = document.getElementById('tgUserLevel');
            if (userLevelEl) {
                userLevelEl.textContent = userLevel;
            }
        }

        // Energy regeneration system
        setInterval(() => {
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 1);
                updateUI();
            }
        }, 6000); // Regenerate 1 energy every 6 seconds

        // Auto-save game state every 30 seconds
        setInterval(() => {
            if (user) {
                saveGameStateToTelegram();
            }
        }, 30000);

        // Initialize game when page loads
        window.addEventListener('load', initGame);
        
        // Handle Telegram WebApp events
        if (typeof Telegram !== 'undefined') {
            Telegram.WebApp.onEvent('mainButtonClicked', () => {
                shareGame();
            });
            
            Telegram.WebApp.onEvent('backButtonClicked', () => {
                showScreen('galaxyScreen');
            });
        }
    </script>
</body>
</html>
